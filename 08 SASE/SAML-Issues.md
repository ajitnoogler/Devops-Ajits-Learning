### Common SAML Issues

| **Issue**                          | **Cause**                                                                                          | **Fix**                                                                                                       |
| ---------------------------------- | -------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| **Clock Skew / Assertion Expired** | IdP and SP system clocks are out of sync, making `<NotBefore>` / `<NotOnOrAfter>` validation fail. | Sync both IdP and SP to the same **NTP server**; increase allowed clock skew (e.g., 2–5 mins) in SP settings. |
| **Invalid Signature**              | SP can’t verify the digital signature; certificate mismatch or corrupted assertion.                | Update the IdP metadata on the SP; ensure the IdP’s signing certificate hasn’t expired.                       |
| **Audience Mismatch**              | `<Audience>` in the assertion doesn’t match the SP’s EntityID.                                     | Verify SP EntityID in IdP config; match it exactly (case-sensitive, no trailing slashes).                     |
| **NameID Format Error**            | IdP sends NameID in a format the SP doesn’t support.                                               | Change NameID format in IdP (e.g., `emailAddress` vs. `unspecified`) to match SP requirements.                |
| **RelayState Lost / Not Passed**   | RelayState parameter (to redirect user after login) not preserved during redirects.                | Ensure RelayState forwarding is enabled on both IdP and SP; check load balancer / proxy rules.                |
| **Wrong Binding Method**           | IdP and SP configured with different bindings (HTTP-Redirect vs HTTP-POST).                        | Configure both sides to use the same SAML binding method.                                                     |
| **Assertion Too Large**            | Too many attributes or large group claims exceed HTTP header/POST size.                            | Reduce attributes in SAML assertion or switch to HTTP-POST binding.                                           |
| **Metadata Outdated**              | SP or IdP using old metadata with stale endpoints or certificates.                                 | Re-import latest metadata from the other side and restart services.                                           |
| **HTTPS Certificate Issues**       | Expired or mismatched SSL/TLS cert on IdP/SP endpoints.                                            | Renew and install proper SSL certificate; update endpoint URLs if needed.                                     |
| **Incorrect ACS URL**              | Assertion sent to wrong Assertion Consumer Service endpoint.                                       | Verify SP ACS URL matches exactly in IdP config.                                                              |
