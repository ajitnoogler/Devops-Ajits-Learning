
# ğŸ” SSL/TLS Handshake â€” Packet Flow

![image](https://github.com/user-attachments/assets/ef05d083-65b1-47df-bcdb-ac5cb7c02c73)


# ğŸ”‘ Key Derivation Overview (TLS 1.2)

1. PreMasterSecret (PMS)

    If RSA: Generated by client, encrypted with server's public key.

    If DHE/ECDHE: Derived mutually using Diffie-Hellman math.

2. MasterSecret
   MasterSecret = PRF(PreMasterSecret, "master secret", ClientRandom + ServerRandom)

3. KeyBlock:
   KeyBlock = PRF(MasterSecret, "key expansion", ServerRandom + ClientRandom)
    KeyBlock is split into:

      Client MAC Key

      Server MAC Key
  
      Client Encryption Key

      Server Encryption Key

      Optional: IVs

4. ğŸ“¦ Example (TLS_RSA_WITH_AES_128_CBC_SHA)
   If cipher suite uses:

    HMAC-SHA1: 20 bytes per MAC key

    AES-128: 16 bytes per encryption key

  Then:
  KeyBlock = 
    20 bytes Client MAC Key
    + 20 bytes Server MAC Key
    + 16 bytes Client Encryption Key
    + 16 bytes Server Encryption Key
    = 72 bytes total


# ğŸ§ª Wireshark Tip: Filters:
    tls.handshake
    or
    ssl

Look for these handshake messages:

    Client Hello

    Server Hello

    Certificate

    ClientKeyExchange

    ChangeCipherSpec

    Finished

Then use:

    Right-click â†’ Follow â†’ TLS Stream


# ğŸ§ª 1. cURL-based TLS 1.3 Handshake Inspection
curl -vk --tls-max 1.3 --tls-min 1.3 https://www.google.com

curl -vk --tls-max 1.3 --tls-min 1.3 https://cloudflare.com


# ğŸ” Explanation:

    -v: verbose output (prints handshake details)

    -k: ignore cert validation

    --tls-max/--tls-min: forces TLS 1.3

# âœ… Output sample (relevant parts):

*   Trying 142.250.192.78:443...
* Connected to www.google.com (142.250.192.78) port 443
* TLS 1.3 (OUT), TLS handshake, Client hello (1):
* TLS 1.3 (IN), TLS handshake, Server hello (2):
* TLS 1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLS 1.3 (IN), TLS handshake, Certificate (11):
* TLS 1.3 (IN), TLS handshake, Certificate Verify (15):
* TLS 1.3 (IN), TLS handshake, Finished (20):
* TLS 1.3 (OUT), TLS handshake, Finished (20):

   
